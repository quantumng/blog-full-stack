<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="degebug.com是一个前端开发者的博客，在这里，你将...等一下，我de个bug先！">
  <meta name="keywords" content="degebug.com,博客,技术,程序员,debug,前端,日记,写作,阅读,原创,吴晓权">
  <title>博客 || degebug.com</title>
  <link rel="stylesheet" href="../static/css/normalize.css">
  <link rel="stylesheet" href="../static/css/common.css">
  <link rel="stylesheet" href="../static/css/detail.css">
</head>
<body>
  <header class="blog-header">
    <h1 class="blog-logo"><a href="/">degebug.com博客</a></h1>
    <nav class="blog-nav">
      <a class="blog-nav-item" href="/">首页</a>
      <a class="blog-nav-item" href="//admin.degebug.com" target="_blank">博客管理</a>
    </nav>
  </header>
  <div class="blog-container">
    <div class="blog-page">
      <h2 class="blog-page-title">云服务器部署博客记录</h2>
      <div class="blog-page-info">
          <span class="blog-page-author">作者：吴晓权</span>
          <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
          <span class='blog-page-comment'>分类：<a href="/">分类目录</a></span>
      </div>
      <div class="blog-page-content">
        <p>一、部署环境<br>&nbsp; 云服务器：腾讯云</p>
        <p>&nbsp; 系统：centos 7</p>
        <p>&nbsp; 包和工具：Xshell（第三方ssh客户端）、FileMozilla（第三方FTP客户端）、yum（centos包管理器）、Nginx（服务器中间代理）、nvm（node版本管理）、node（javascript运行时环境）、MongoDB（数据库）、PM2（node进程管理）</p>
        <p>二、安装流程</p>
        <p>&nbsp; 1、先升级一下yum（腾讯云已集成yum）</p>
        <p>&nbsp;&nbsp;<span style="background-color: rgb(241, 241, 241); font-family: Consolas, Menlo, Courier, monospace; font-size: 1em;">sudo yum update</span></p>
        <p>&nbsp; 2、安装Nginx</p>
        <p>&nbsp; 官方安装教程：<a href="http://nginx.org/en/linux_packages.html#RHEL-CentOS" target="_blank" style="background-color: rgb(255, 255, 255);">链接</a></p>
        <p>&nbsp;&nbsp;<span style="background-color: rgb(241, 241, 241); font-family: Consolas, Menlo, Courier, monospace; font-size: 1em;">// 先安装先决条件（基础组件）（腾讯云已集成）</span></p>
        <pre><code>sudo yum install yum-utils<br>// 创建仓库文件<br>// 目录/etc/yum.repos.d/nginx.repo<br><br>// 仓库文件内容<br>[nginx-stable]<br>name=nginx stable repo<br>baseurl=http://nginx.org/packages/centos/$releasever/$basearch/<br>gpgcheck=1<br>enabled=1<br>gpgkey=https://nginx.org/keys/nginx_signing.key<br>[nginx-mainline]<br>name=nginx mainline repo<br>baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/<br>gpgcheck=1<br>enabled=0<br>gpgkey=https://nginx.org/keys/nginx_signing.key<br><br>// 默认情况下，使用的是稳定版Nginx包仓库。如果你要使用主力版本的Nginx包，需要执行以下命令行<br>sudo yum-config-manager --enable nginx-mainline<br><br>// 安装Nginx<br>sudo yum install nginx<br><br>// 如果提示接受GPP Key,验证指纹码是否适配573B FD6B 3D8F BC64 1079 A6AB ABF5 BD82 7BD9 BF62，是的话就按受<br><br>// 其他命令参考<br>* systemctl enable nginx // 设置开机自启动<br>* systemctl start nginx // 启动nginx<br>* rpm -ql nginx // 查看nginx的位置，进而找到nginx.conf文件的位置<br>到这一步由于nginx的监听端口默认是80，所以直接访问服务器的公网IP已经可以看到nginx的欢迎页面了<br>* ps -ef | grep nginx // 查看nginx进程<br>* kill -9 pId // kill对应的进程<br>* pkill -9 nginx // kill掉nginx全部进程</code></pre>
        <p>&nbsp; 3、安装NVM</p><p>&nbsp; 官方教程：<a href="https://github.com/creationix/nvm#installation-and-update" target="_blank" style="background-color: rgb(255, 255, 255);">链接</a></p>
        <p>&nbsp;&nbsp;<span style="background-color: rgb(241, 241, 241); font-family: Consolas, Menlo, Courier, monospace; font-size: 1em;">// curl安装</span></p>
        <pre><code>curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.34.0/install.sh | bash<br>// wget安装<br>wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.34.0/install.sh | bash<br>// 如果安装后发现执行'nvm -v'提示未发现该命令或执行'command -v nvm'没有反应，则重启一下shell命令工具再试</code></pre>
        <p>&nbsp; 4、安装node（推荐安装长期维护版本）</p>
        <p>&nbsp; 官网：<a href="https://nodejs.org/zh-cn/" target="_blank" style="background-color: rgb(255, 255, 255);">链接</a></p>
        <pre><code>// 安装<br>nvm install 版本号<br>// 使用<br>nvm use 版本号</code></pre>
        <p>&nbsp; 5、安装PM2</p>
        <p>&nbsp; 官方教程：<a href="https://pm2.io/doc/en/runtime/overview/" target="_blank" style="background-color: rgb(255, 255, 255);">链接</a></p>
        <pre><code>// npm安装<br>npm install pm2 -g<br>// yarn安装<br>yarn global add pm2<br>// 使用<br>pm2 start app.js(node服务的入口文件)</code></pre>
        <p>&nbsp; 6、安装MongoDB</p>
        <p>&nbsp; 官方安装教程：<a href="https://docs.mongodb.com/manual/installation/#mongodb-community-edition" target="_blank" style="background-color: rgb(255, 255, 255);">链接</a></p>
        <pre><code>// 创建仓库文件<br>//目录：/etc/yum.repos.d/mongodb-org-4.0.repo<br><br>//仓库文件内容<br>[mongodb-org-4.0]name=MongoDB Repositorybaseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.0/x86_64/gpgcheck=1enabled=1gpgkey=https://www.mongodb.org/static/pgp/server-4.0.asc<br><br>//安装mongodb<br>sudo yum install -y mongodb-org<br>// 如果你要安装特定版本，就执行以下命令<br>sudo yum install -y mongodb-org-4.0.8 mongodb-org-server-4.0.8 mongodb-org-shell-4.0.8 mongodb-org-mongos-4.0.8 mongodb-org-tools-4.0.8<br>// 不过，当你指定了版本，yum会在新版本出来后升级包，为了阻止自动升级，可以在/etc/yum.conf文件里添加一条排除命令<br>exclude=mongodb-org,mongodb-org-server,mongodb-org-shell,mongodb-org-mongos,mongodb-org-tools<br><br>//启动MongoDB服务<br>sudo service mongod start<br><br>// 停止服务<br>sudo service mongod stop<br><br>// 重启服务<br>sudo service mongod restart<br><br>// 设置随系统启动服务<br>sudo chkconfig mongod on<br><br>// 使用mongodb<br>mongo</code></pre>
        <p>&nbsp; MongoDB数据库默认可以无密码访问，安全起见建议设置一下管理</p><pre><code>// 切换到admin<br>use admin<br>// 创建根用户（管理员）<br>db.createUser({user: 'root', pwd: '123456', roles: ['root']})<br><br>// 验证创建是否成功，成功会返回1<br>db.auth('root', '123456')<br><br>// 单独为某个库创建有读写权限的用户，先切换到要创建的数据库<br>use anydb<br><br>// 按照之前创建管理员的命令创建新用户<br>db.createUser({user: 'anyuser', pwd: 'anypassword', roles: [{role: 'readWrite', db: 'anydatabase'}]})<br><br>// 再次验证是否创建成功<br>db.auth('<span style="font-size: 1em;">anyuser</span><span style="font-size: 1em;">', '</span>anypassword<span style="font-size: 1em;">')</span><br><br>// 创建用户后数据库的链接格式<br>'mongodb://user:pwd@ip:27017/db'</code></pre><p>&nbsp; 7、上传代码，配置Nginx</p><p>&nbsp; 因为整个博客分为博客和后台管理两个站点，后台管理采用二级域名的形式。</p>
        <p>&nbsp;&nbsp;<span style="background-color: rgb(241, 241, 241); font-family: Consolas, Menlo, Courier, monospace; font-size: 1em;"># 配置博客页面</span></p>
        <pre><code>server {<br>listen 80;<br>server_name degebug.com www.degebug.com;<br><br>location / {<br>root /home/www/blog/;<br>index index.html index.htm;<br>}↵↵location /api {<br>proxy_set_header X-Real-IP $remote_addr;<br>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>proxy_set_header Host $http_host;<br>proxy_set_header X-NginX-Proxy true;<br>proxy_pass http://localhost:8080;<br>proxy_redirect off;<br>}<br>}<br># 配置后台管理系统<br>server {<br>listen 80;<br>server_name admin.degebug.com;<br># root /usr/share/nginx/html;<br>↵location / {<br>root /home/www/admin/;<br>index index.html index.htm;<br>}<br>location /api {<br>proxy_set_header X-Real-IP $remote_addr;<br>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>proxy_set_header Host $http_host;<br>proxy_set_header X-NginX-Proxy true;<br>proxy_pass http://localhost:8080;<br>proxy_redirect off;<br>}</code></pre>
        <p>&nbsp; 至此，整个站点部署完毕，测试页面OK。</p>
      </div>
    </div>
    <aside class="blog-top" id="blogTop">Top</aside>
  </div>
  <footer class="blog-footer">
    <p>Copyright&copy;2018-2019 吴晓权 版权所有</p>
    <p><a target="_blank" rel="noopener noreferrer" href="http://www.miitbeian.gov.cn">粤ICP备18084360号-1</a></p>
  </footer>
</body>
<script src="../static/js/jquery-3.3.1.js"></script>
<script src="../static//js/index.js"></script>
</html>